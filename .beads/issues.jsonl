{"id":"ncp-0oe","title":"Implement version subcommand","description":"Add `niri msg version` tool to print the version of the running niri instance.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-03T06:41:01.699956123-05:00","created_by":"rektide","updated_at":"2026-01-03T06:41:01.699956123-05:00"}
{"id":"ncp-4ll","title":"Write type definitions for listing tools","description":"Write TypeScript type definitions for the response data from niri msg subcommands: outputs, workspaces, windows, layers, keyboard-layouts, focused-output, focused-window, overview-state. Create types that match the actual JSON schema returned by niri.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-11T16:28:53.13682858-05:00","updated_at":"2026-01-11T16:28:53.13682858-05:00"}
{"id":"ncp-78m","title":"Implement pick-window subcommand","description":"Add `niri msg pick-window` tool to pick a window with the mouse and print information about it.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-03T06:41:01.700135707-05:00","created_by":"rektide","updated_at":"2026-01-03T06:41:01.700135707-05:00"}
{"id":"ncp-8as","title":"Implement keyboard-layouts subcommand","description":"Add `niri msg keyboard-layouts` tool to get the configured keyboard layouts from the running niri instance.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-03T06:41:01.698554622-05:00","created_by":"rektide","updated_at":"2026-01-03T06:41:01.698554622-05:00"}
{"id":"ncp-9ry","title":"Implement output subcommand","description":"Add `niri msg output` tool to change output configuration temporarily (e.g., scale, transform, mode).","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-03T06:41:01.699602415-05:00","created_by":"rektide","updated_at":"2026-01-03T06:41:01.699602415-05:00"}
{"id":"ncp-a51","title":"Implement config block management tool","description":"Add a tool for managing ~/.config/niri/config.d/ files. Support actions: status (default), enable, disable, toggle. Accept optional pattern parameter to match config blocks. Manages whether config blocks are enabled/disabled (e.g., by renaming .disabled files or commenting blocks).","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-11T16:28:49.557249177-05:00","updated_at":"2026-01-11T16:28:49.557249177-05:00"}
{"id":"ncp-dfv","title":"Implement action subcommand","description":"Add `niri msg action` tool to perform actions on the niri window manager (e.g., focus-window, quit-window, toggle-float, etc.).","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-03T06:41:01.700453584-05:00","created_by":"rektide","updated_at":"2026-01-03T06:41:01.700453584-05:00"}
{"id":"ncp-es","title":"Implement event-stream subcommand","description":"Epic for implementing real-time event streaming from niri compositor to MCP clients via Streamable HTTP transport with SSE-based event proxying. Enables clients to subscribe to niri state changes (workspaces, windows, keyboard layouts, overview, config reloads) with optional event type and field expression filtering.\n\nSee ADR-003 (@doc/adr/03-event-streaming.md) for complete architecture, component breakdown, and implementation phases.","design":"See ADR-003 (@doc/adr/03-event-streaming.md) for complete architecture, component breakdown, and implementation phases.\n\n**Architecture Overview:**\n- EVENT-TOOL: MCP tool interface for subscribing to niri events with filtering\n- EVENT-BRIDGE: Bridges niri subprocess to SSE format via sendNotification()\n- EVENT-FILTER: Field expression filtering engine (eq, ne, gt, lt, gte, lte, contains, startsWith, endsWith)\n- SSE-BRIDGE: SSE formatting utilities (event: \u003ctype\u003e\\ndata: \u003cjson\u003e\\n\\n)\n- CLIENT-SUBSCRIPTION: Client-side consumption model via StreamableHttpClient\n\n**Transport Choice:** Streamable HTTP (protocol version 2025-11-25) using StreamableHttpServer/StreamableHttpClient from MCP SDK. Chosen over legacy SSE for built-in session management, resumability, and active maintenance.\n\n**Key Design Decisions:**\n- Tool-based subscriptions (not resource subscriptions) for simpler MCP pattern\n- Server-side filtering for bandwidth efficiency\n- Line-by-line JSON parsing from niri msg --json event-stream\n- Isolated subprocess per subscription (can optimize later)\n- Stdio transport maintained for backwards compatibility during transition","status":"open","priority":4,"issue_type":"epic","created_at":"2026-01-03T06:41:01.702721964-05:00","created_by":"rektide","updated_at":"2026-01-21T23:27:57.263122394-05:00"}
{"id":"ncp-es-build-bridge","title":"event-stream: Build event bridge","description":"Create tool/event-stream/bridge.ts with EventBridge class that spawns niri msg --json event-stream subprocess, reads stdout line-by-line, parses JSON, applies filters via EVENT-FILTER, and writes SSE events via extra.sendNotification() (doc/adr/03-event-streaming.md Phase 2). Handle cleanup on stop/error with proper resource cleanup in finally blocks and AbortController for cancellation.\n\n**EventBridge Class:**\n- process: Subprocess for niri msg --json event-stream\n- filterEngine: Instance using EVENT-FILTER applyFilters\n- sseStream: WritableStream from sendNotification()\n- start(params): Spawn subprocess, attach stdout handler, filter and format events\n- stop(): Kill process, close stream, cleanup handlers\n\n**Error Handling:** Invalid JSON lines logged as warnings and skipped. Process exit closes SSE stream immediately. Subprocess tracked with PID for cleanup on disconnect.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-21T23:28:54.636206798-05:00","updated_at":"2026-01-21T23:28:54.636206798-05:00","dependencies":[{"issue_id":"ncp-es-build-bridge","depends_on_id":"ncp-es","type":"parent-child","created_at":"2026-01-21T23:29:12.358490626-05:00","created_by":"daemon"}]}
{"id":"ncp-es-build-filter","title":"event-stream: Build filter engine","description":"Create tool/event-stream/filter.ts with applyFilters\u003cT\u003e() function that applies field expression filtering to niri event payloads (doc/adr/03-event-streaming.md Phase 3). Support dot notation for nested field access (e.g., \"output.name\") and array indexing (e.g., \"windows.0.title\"). Implement all operators: eq, ne, gt, lt, gte, lte, contains, startsWith, endsWith. Reuse pattern from utils/filter.ts where compatible for consistency.\n\n**Function Signature:**\n```typescript\nfunction applyFilters\u003cT\u003e(payload: T, filters: FilterExpr[]): boolean\n```\n\n**Logic:** Apply all filters with AND logic - return true only if all filters match. This enables server-side filtering to reduce bandwidth and latency.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-21T23:28:49.512239589-05:00","updated_at":"2026-01-21T23:28:49.512239589-05:00","dependencies":[{"issue_id":"ncp-es-build-filter","depends_on_id":"ncp-es","type":"parent-child","created_at":"2026-01-21T23:29:11.377756956-05:00","created_by":"daemon"}]}
{"id":"ncp-es-define-types","title":"event-stream: Define types and schemas","description":"Create tool/event-stream/types.ts with EVENT_TYPES constant array and FilterExprSchema Zod schema (doc/adr/03-event-streaming.md Phase 5). Export all types for tool registration, event filtering, and client subscription model.\n\n**EVENT_TYPES:** WorkspacesChanged, WindowsChanged, KeyboardLayoutsChanged, OverviewOpenedOrClosed, ConfigLoaded\n\n**FilterExprSchema:** Zod schema for field expression filtering with operators: eq, ne, gt, lt, gte, lte, contains, startsWith, endsWith. Support dot notation and array indexing for field access.\n\n**Exports:** EVENT_TYPES, FilterExprSchema, FilterExpr type, and any other helper types needed for EVENT-TOOL, EVENT-BRIDGE, and EVENT-FILTER components.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-21T23:28:46.250746554-05:00","updated_at":"2026-01-21T23:28:46.250746554-05:00","dependencies":[{"issue_id":"ncp-es-define-types","depends_on_id":"ncp-es","type":"parent-child","created_at":"2026-01-21T23:29:10.787857269-05:00","created_by":"daemon"}]}
{"id":"ncp-es-docs","title":"event-stream: Update documentation","description":"Update main README.md with EVENT-TOOL usage documentation (doc/adr/03-event-streaming.md Phase 7). Add example client code using StreamableHttpClient from MCP SDK. Document available event types (WorkspacesChanged, WindowsChanged, KeyboardLayoutsChanged, OverviewOpenedOrClosed, ConfigLoaded) and their mappings to SSE event names. Document filter syntax with examples for field expressions and operators. Document transport choice (Streamable HTTP vs legacy SSE) and rationale. Add troubleshooting section for common issues: niri not running, subprocess orphaned, client disconnect handling, SSE stream not receiving events.\n\n**Example Client Code:**\n```typescript\nconst client = new StreamableHttpClient({ url: \"http://localhost:3000/mcp\" });\nconst stream = await client.callTool(\"niri_event_stream\", {\n  events: [\"WindowsChanged\"],\n  filters: [{ field: \"output\", operator: \"eq\", value: \"DP-1\" }]\n});\nfor await (const event of stream) {\n  console.log(`${event.event}: ${event.data}`);\n}\n```\n\n**Transport Docs:** Explain Streamable HTTP benefits (session management, resumability, protocol 2025-11-25) vs stdio transport.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-21T23:29:06.513890961-05:00","updated_at":"2026-01-21T23:29:06.513890961-05:00","dependencies":[{"issue_id":"ncp-es-docs","depends_on_id":"ncp-es","type":"parent-child","created_at":"2026-01-21T23:29:17.43088059-05:00","created_by":"daemon"}]}
{"id":"ncp-es-register-tool","title":"event-stream: Register event tool","description":"Create tool/event-stream/index.ts with niri_event_stream tool definition and handler (doc/adr/03-event-streaming.md Phase 4, EVENT-TOOL component). Define Zod inputSchema with optional events (array of EVENT_TYPES) and filters (array of FilterExpr). Implement handler that validates params, creates EventBridge instance, passes extra.sendNotification() for SSE stream, handles errors/exceptions, and returns success response with stream reference. Register tool in main server initialization (niri-mcp.ts).\n\n**Tool Schema:**\n```typescript\n{\n  name: \"niri_event_stream\",\n  description: \"Subscribe to niri event stream with optional filters\",\n  inputSchema: z.object({\n    events: z.array(z.enum(EVENT_TYPES)).optional(),\n    filters: z.array(FilterExprSchema).optional(),\n  })\n}\n```\n\n**Handler Flow:** Validate params → Create EventBridge → Start subprocess → Return response indicating SSE stream is active via sendNotification().","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-21T23:28:57.510666916-05:00","updated_at":"2026-01-21T23:28:57.510666916-05:00","dependencies":[{"issue_id":"ncp-es-register-tool","depends_on_id":"ncp-es","type":"parent-child","created_at":"2026-01-21T23:29:12.657880574-05:00","created_by":"daemon"}]}
{"id":"ncp-es-setup-http","title":"event-stream: Setup Streamable HTTP transport","description":"Update niri-mcp.ts to use StreamableHttpServerTransport from MCP SDK (doc/adr/03-event-streaming.md Phase 1). Add transport initialization with endpoint configuration and server connection setup. Maintain stdio transport for backwards compatibility during transition period. Test basic server connectivity with StreamableHttpClient to verify transport works correctly.\n\n**Transport Configuration:**\n```typescript\nimport { StreamableHttpServerTransport } from '@modelcontextprotocol/sdk/server/streamableHttp.js';\nconst transport = new StreamableHttpServerTransport({ endpoint: \"/mcp\" });\n```\n\n**Rationale:** Streamable HTTP is recommended transport for remote servers, uses protocol version 2025-11-25, provides built-in session management and resumability via Last-Event-ID.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-21T23:28:43.772859722-05:00","updated_at":"2026-01-21T23:28:43.772859722-05:00","dependencies":[{"issue_id":"ncp-es-setup-http","depends_on_id":"ncp-es","type":"parent-child","created_at":"2026-01-21T23:29:10.241535704-05:00","created_by":"daemon"}]}
{"id":"ncp-es-sse-formatter","title":"event-stream: Build SSE formatter","description":"Create tool/event-stream/sse-formatter.ts with toSSEEvent() function that converts niri JSON events to Server-Sent Events format (doc/adr/03-event-streaming.md Phase 6 SSE-BRIDGE component). Map niri event keys to SSE event names (e.g., WorkspacesChanged → workspaces_changed). Format output as:\n```\nevent: \u003ctype\u003e\ndata: \u003cjson\u003e\n\n```\nSupport optional metadata fields (id, retry) for advanced SSE features.\n\n**Function Signature:**\n```typescript\nfunction toSSEEvent(type: string, payload: unknown): string\n```","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-21T23:28:51.877745573-05:00","updated_at":"2026-01-21T23:28:51.877745573-05:00","dependencies":[{"issue_id":"ncp-es-sse-formatter","depends_on_id":"ncp-es","type":"parent-child","created_at":"2026-01-21T23:29:11.782272076-05:00","created_by":"daemon"}]}
{"id":"ncp-es-tests","title":"event-stream: Write tests","description":"Write comprehensive tests for event-stream tool covering all scenarios (doc/adr/03-event-streaming.md Phase 6 Testing). Test suite includes: basic subscription (no filters, all events), event type filtering (subscribe to only WindowsChanged), field filtering (windows on specific output), complex filters (multiple filter expressions AND'ed together), error handling (invalid JSON, niri crash), disconnection (client disconnects mid-stream), concurrent subscriptions (multiple tool calls spawn isolated bridges), and subprocess cleanup (verify niri processes killed on disconnect).\n\n**Test Approach:** Spawn mock niri subprocess, trigger window changes programmatically, verify events appear in SSE stream with correct format, verify filtering reduces output, verify SSE format matches specification (event: / data: lines), verify cleanup works properly on disconnect/error.\n\n**Coverage Goals:** Verify transport setup, EventBridge parsing/filtering, SSE formatter, tool registration, and subprocess lifecycle management all work correctly.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-21T23:28:59.770874702-05:00","updated_at":"2026-01-21T23:28:59.770874702-05:00","dependencies":[{"issue_id":"ncp-es-tests","depends_on_id":"ncp-es","type":"parent-child","created_at":"2026-01-21T23:29:17.021283333-05:00","created_by":"daemon"}]}
{"id":"ncp-ho1","title":"Implement focused-window subcommand","description":"Add `niri msg focused-window` tool to print information about the currently focused window.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-03T06:41:01.695380332-05:00","created_by":"rektide","updated_at":"2026-01-03T06:41:01.695380332-05:00"}
{"id":"ncp-r75","title":"Add column filtering to all query tools","description":"Add include/exclude column filtering to niri_outputs, niri_workspaces, niri_windows, and niri_layers tools. Allow users to specify which fields to return or exclude.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-03T06:44:49.462686807-05:00","created_by":"rektide","updated_at":"2026-01-03T07:15:05.336472769-05:00","closed_at":"2026-01-03T07:15:05.336472769-05:00","close_reason":"Completed"}
{"id":"ncp-vun","title":"Implement focused-output subcommand","description":"Add `niri msg focused-output` tool to print information about the currently focused output.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-03T06:41:01.693574482-05:00","created_by":"rektide","updated_at":"2026-01-03T06:41:01.693574482-05:00"}
{"id":"ncp-wzp","title":"Implement pick-color subcommand","description":"Add `niri msg pick-color` tool to pick a color from the screen with the mouse.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-03T06:41:01.699455972-05:00","created_by":"rektide","updated_at":"2026-01-03T06:41:01.699455972-05:00"}
{"id":"ncp-x8v","title":"Implement overview-state subcommand","description":"Add `niri msg overview-state` tool to print the current overview state.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-03T06:41:01.701501097-05:00","created_by":"rektide","updated_at":"2026-01-03T06:41:01.701501097-05:00"}
